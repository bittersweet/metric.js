// Generated by CoffeeScript 1.4.0
(function(){var e;e={setApiKey:function(e){return this.api_key=e},setUrl:function(e){return this.url=e},log:function(e){if(console)return console.log(e)},track:function(e,t){var n;return t==null&&(t={}),n=this.generateTrackingUrl(e,t),this.sendRequest(n,t.callback)},generateTimeString:function(){return(new Date).getTime().toString()},generateTrackingUrl:function(e,t){var n,r,i;return t==null&&(t={}),r=this.generateTimeString(),i=this.url||"https://api.metric.io",n=t.amount||1,i=""+i+"/v1/sites/"+this.api_key+"/track",this.buildUrl(i,{metric:e,amount:n,time:r,meta:t.meta})},generateStatisticsUrl:function(e,t,n){var r;return r=this.url||"https://api.metric.io",r=""+r+"/v1/sites/"+this.api_key+"/statistics",this.buildUrl(r,{metric:e,metric:e,range:t,token:n})},receive:function(e,t,n){var r;return r=this.generateStatisticsUrl(e,t,n),this.sendRequest(r,callback)},sendRequest:function(t,n){var r;n||(n=this.log),r=new XMLHttpRequest;if(r.withCredentials!==void 0)return r.open("GET",t,!0),r.onreadystatechange=function(t){if(r.readyState===4)return r.status===200?n(r.responseText):e.log("Bad HTTP status",r.status,r.statusText)},r.send()},serialize:function(e,t){var n,r,i,s;i=[];for(r in e)s=e[r],s&&(n=t?t+"["+r+"]":r,typeof s=="object"?i.push(this.serialize(s,n)):i.push(encodeURIComponent(n)+"="+encodeURIComponent(s)));return i.join("&")},buildUrl:function(e,t){var n;return n=this.serialize(t),n.length>0&&(e=e+"?"+n),e}},typeof window=="undefined"?this.metric=e:window.metric=e}).call(this);